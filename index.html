<!doctype html>
<html lang="it">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Sega Master System emulator for your browser">
        <meta name="keywords" content="Sega Master System emulator, coding, emulation, SEGA, games, 1987">

        <link rel="icon" type="image/png" href="img/favicon.ico"/>
        <title>Zenga - version 0.9a</title>

        <link rel="stylesheet" href="css/main.css"/>
        
        <script src="js/sn79489.js"></script>
        <script src="js/smsMmu.js"></script>
        <script src="js/smsVdp.js"></script>
        <script src="js/testMMU.js"></script>
        <script src="js/z80cpu.js"></script>
        <script src="js/cpuTestRunner.js"></script>
        <script src="js/cartridge.js"></script>
        <script src="js/serializer.js"></script>
        <script src="js/main.js"></script>

        <style>
            /* --- Mobile Controls --- */
            .controls {
                position: absolute;
                bottom: 20px;
                left: 20px;
                z-index: 9999;
                user-select: none;
            }
            .dpad {
                position: relative;
                width: 120px;
                height: 120px;
            }
            .dpad button {
                position: absolute;
                width: 40px;
                height: 40px;
                background: rgba(255,255,255,0.2);
                border: 2px solid #999;
                border-radius: 5px;
                color: white;
                font-weight: bold;
            }
            .dpad .up { top: 0; left: 40px; }
            .dpad .down { bottom: 0; left: 40px; }
            .dpad .left { left: 0; top: 40px; }
            .dpad .right { right: 0; top: 40px; }

            .buttons {
                position: absolute;
                right: 20px;
                bottom: 40px;
            }
            .buttons button {
                width: 60px;
                height: 60px;
                margin-left: 20px;
                border-radius: 50%;
                border: 2px solid #aaa;
                background: rgba(255,0,0,0.3);
                color: white;
                font-weight: bold;
            }
        </style>
    </head>

    <body>
        <div id="titleDiv"><img src="img/zenga.png" /> <b>Zenga</b> emulator v0.9a - <span id="fpsSpan"></span>
            <a class="tooltip" href=""><img src="img/camera.png" /><span><img src="img/defaultss.png" id="savestateImg" /></span></a>
            <a class="tooltip" href=""><img src="img/info.png" /><span style="min-width: 160px">z, x and arrows to play, \ to ffwd, p to pause, o is the SMS pause button, F2 and F3 to save and load</span></a>
        </div>

        <canvas width=800 height=400 id="debugCanvas" style="display: none;"></canvas>
        <canvas width=256 height=240 id="smsdisplay"></canvas>

        <button id="fsbutton" onclick="fullscreen();" style="display: none;">Go fullscreen!</button>
        
        <!-- rom selector -->
        <div id="fileselector">
            <button style="cursor:pointer" id="romLoaderBtn">Load rom</button>
            <input type="file" id="cartridgeSelector" style="display:none" onchange="handleCartridgeUpload(this.files)">(load .sms or .sg rom)<br/><br/>
        </div>

        <!-- software selector -->
        <span id="softLoader" style="float:left;clear:both;margin-top:10px">Load pd game/demo: 
            <select name="software" id="softwareSelector" onchange="loadSoftware(this)">
                <option value="run">--</option>
                <option value="GenesisProject-Lambo.sms">Lambo/Genesys Project (demo)</option>
                <option value="Be No Sqr 1.01.sms">Be No Sqr (demo/PAL)</option>
                <option value="2048.sms">2048 (homebrew game)</option>
                <option value="DTS_Final_DemoVersion.sms">Do The Same (homebrew game)</option>
                <option value="BaraBuruu-SMS-1.00.sms">Bara Buru (homebrew game)</option>
                <option value="FlightOfPigarus-SMS-1.11.sms">Flight Of Pigarus (homebrew game)</option>
                <option value="rick.sms">Jewel Jones (homebrew game demo)</option>
                <option value="lander2_v0C.sms">Lander2 (homebrew game)</option>
                <option value="WingWarriors.sms">Wing Warriors (homebrew game)</option>
                <option value="monkeylad.sms">Monkey Lad (homebrew game)</option>
                <option value="BruceLee-SMS-1.00.sms">Bruce Lee (homebrew game)</option>
            </select>
        </span>

        <!-- NTSC/PAL selector -->
        <span id="vdpMode" style="float:left;clear:both;margin-top:10px">TV Standard
            <select name="vdpMode" id="vdpModeSelector" onchange="setVdpStandard(this)">
                <option value="NTSC">NTSC</option>
                <option value="PAL">PAL</option>
            </select>
        </span>

        <!-- On-screen Controls -->
        <div class="controls">
            <div class="dpad">
                <button class="up" data-key="ArrowUp">▲</button>
                <button class="down" data-key="ArrowDown">▼</button>
                <button class="left" data-key="ArrowLeft">◀</button>
                <button class="right" data-key="ArrowRight">▶</button>
            </div>
        </div>
        <div class="buttons">
            <button data-key="KeyZ">A</button>
            <button data-key="KeyX">B</button>
            <button data-key="KeyO">Pause</button>
        </div>

        <script>
            // Map touch buttons -> keyboard events
            const pressKey = (code, type) => {
                document.dispatchEvent(new KeyboardEvent(type, { code, key: code }));
            };

            document.querySelectorAll("button[data-key]").forEach(btn => {
                const key = btn.getAttribute("data-key");
                btn.addEventListener("touchstart", e => {
                    e.preventDefault();
                    pressKey(key, "keydown");
                });
                btn.addEventListener("touchend", e => {
                    e.preventDefault();
                    pressKey(key, "keyup");
                });
            });
        </script>
    </body>
</html>

